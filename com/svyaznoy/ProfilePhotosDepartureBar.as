package com.svyaznoy {	import com.flashgangsta.managers.MappingManager;	import flash.display.Sprite;	import flash.text.TextFormat;		/**	 * ...	 * @author Sergey Krivtsov (flashgangsta@gmail.com)	 */	public class ProfilePhotosDepartureBar extends Sprite {				private const ROW_COUNT:int = 3;		private const MARGIN_H:int = 20;				private var button:DeparturesPhotosButton;		private var datasList:Vector.<Object>;		private var photosContainer:Sprite = new Sprite();		private var nameTextFormat:TextFormat;		private var lengthTextFormat:TextFormat;		private var departureID:String;				/**		 * 		 * @param	datasList		 */				public function ProfilePhotosDepartureBar( datasList:Vector.<Object> ) {			this.datasList = datasList;			departureID = datasList[ 0 ].departure_id;			button = getChildByName( "button_mc" ) as DeparturesPhotosButton;			nameTextFormat = button.getLabelTextFormat();			lengthTextFormat = button.getLabelTextFormat();			lengthTextFormat.color = 0xFFFFFF;			lengthTextFormat.size = 14;			setLabel();			addPhotos();			button.enabled = button.iconVisible = datasList.length > ROW_COUNT;		}				/**		 * 		 */				public function setLabel():void {			var length:int = datasList.length;						if ( !length ) return;						if ( length < ROW_COUNT ) {				button.iconVisible = false;			} else if ( !button.iconVisible ) {				button.iconVisible = true;			}			var lengthMessage:String = " (" + length + " фото)";			var name:String = datasList[ 0 ].departureName;			var message:String = name + lengthMessage;			button.setLabel( message.toUpperCase() ) ;			button.setLabelTextFormat( nameTextFormat, -1, name.length );			button.setLabelTextFormat( lengthTextFormat, name.length + 1, message.length );			button.setLabel( message.toUpperCase() ) ;		}				/**		 * 		 */				public function dispose():void {			trace( "Bar.dispose()" );			var photo:PreviewDepartureImage;						while ( photosContainer.numChildren ) {				photo = photosContainer.getChildAt( 0 ) as PreviewDepartureImage;				photo.dispose();				photosContainer.removeChild( photo );				photo = null;			}						button.dispose();		}				/**		 * 		 * @return		 */				public function getDepartureID():String {			return departureID;		}				/**		 * 		 * @param	editedPhotoPreview		 */				public function movePhoto( photo:PreviewDepartureImage ):void {			var length:int;			length = getClosedLength();						if ( button.isOpened && photosContainer.numChildren > ROW_COUNT) {				return;			}						photosContainer.addChild( photo );						setLabel();			alignPhotos();		}				/**		 * 		 * @param	photo		 */				public function removePhoto( photo:PreviewDepartureImage ):void {			photosContainer.removeChild( photo );			alignPhotos();			setLabel();		}				/**		 * 		 */				public function get numPhotos():int {			return photosContainer.numChildren;		}				/**		 * 		 */				override public function get height():Number {			var result:Number = 0;			for ( var i:int = 0; i < photosContainer.numChildren; i++ ) {				result = Math.max( result, photosContainer.getChildAt( i ).height );			}			return result + photosContainer.y;		}				/**		 * 		 */				private function alignPhotos():void {			var numPhotos:int = photosContainer.numChildren;			var photo:PreviewDepartureImage;			for ( var i:int = 0; i < numPhotos; i++ ) {				photo = photosContainer.getChildAt( i ) as PreviewDepartureImage;				photo.x = Math.round( ( photo.width + MARGIN_H ) * ( i % ROW_COUNT ) );			}		}				/**		 * 		 */				private function addPhotos():void {			var length:int = getClosedLength();						for ( var i:int = 0; i < length; i++ ) {				addPhotoToDisplayByIndex( i );			}						alignPhotos();						photosContainer.y = MappingManager.getBottom( button, this ) + 10;			addChild( photosContainer );		}				/**		 * 		 * @return		 */				private function getClosedLength():int {			return Math.min( datasList.length, ROW_COUNT );		}				/**		 * 		 * @param	index		 */				private function addPhotoToDisplayByIndex( index:int ):void {			var photo:PreviewDepartureImage = new PreviewDepartureImage( datasList[ index ] );			photosContainer.addChild( photo );		}			}}