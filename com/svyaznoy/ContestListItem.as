package com.svyaznoy {	import com.flashgangsta.managers.MappingManager;	import com.svyaznoy.events.ProviderEvent;	import com.svyaznoy.events.ScreenEvent;	import com.svyaznoy.gui.LabelWithIcon;	import flash.display.DisplayObject;	import flash.display.Sprite;	import flash.events.Event;	import flash.text.TextField;		/**	 * ...	 * @author Sergey Krivtsov (flashgangsta@gmail.com)	 */	public class ContestListItem extends ContestSectionListItem {				private var awardIcon:LabelWithIcon;		private var previews:Sprite;				/**		 * 		 * @param	data		 */				public function ContestListItem( data:Object ) {			var lastItem:DisplayObject;			super( data );			awardIcon = getChildByName( "award_mc" ) as LabelWithIcon;			previews = getChildByName( "previews_mc" ) as Sprite;						titleLabel.text = String( data.title ).toUpperCase();			awardIcon.value = data.points;						if ( !previewIcon.visible ) {				awardIcon.y = MappingManager.getBottom( messageLabel, this ) + 10;				lastItem = awardIcon;			} else {				lastItem = messageLabel.y + messageLabel.height > awardIcon.y + awardIcon.height ? messageLabel : awardIcon;			}												if ( data.type === "photos" ) {				previews.y = MappingManager.getBottom( lastItem, this ) + 25;				previews.visible = false;				lastItem = previews;				loader = provider.getContestWorksList( data.id, previews.numChildren, 0, false, "created_at:desc" );				loader.addEventListener( ProviderEvent.ON_CONTEST_WORKS_LIST, onWorks );			} else {				previews.visible = false;				previews.y = 0;			}						awardIcon.x = MappingManager.getCentricPoint( previewIcon.width, awardIcon.width );						detailsButton.y = MappingManager.getBottom( lastItem, this ) + 10;			divider.y = MappingManager.getBottom( detailsButton, this ) + 17;		}				/**		 * 		 * @param	event		 */				private function onWorks( event:ProviderEvent ):void {			var works:Array = event.data as Array;			loader.removeEventListener( ProviderEvent.ON_CONTEST_WORKS_LIST, onWorks );			loader = null;						for ( var i:int = 0; i < works.length; i++ ) {				AvatarContainer( previews.getChildAt( i ) ).loadByPath( works[ i ].photo_thumbnails_with_path );			}						for ( i; i < previews.numChildren; i++ ) {				previews.getChildAt( i ).visible = false;			}						if ( works.length ) {				previews.visible = true;			} else {				var lastItem:DisplayObject = messageLabel.y + messageLabel.height > awardIcon.y + awardIcon.height ? messageLabel : awardIcon;				previews.y = 0;				detailsButton.y = MappingManager.getBottom( lastItem, this ) + 10;				divider.y = MappingManager.getBottom( detailsButton, this ) + 17;				previews.visible = false;				dispatchEvent( new ScreenEvent( ScreenEvent.HEIGHT_UPDATED, true ) );			}		}			}}